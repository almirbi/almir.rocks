window.addEventListener("load",()=>{function e(){window.removeEventListener("scroll",e);let t=document.querySelector("#game-wrapper .icons"),n=["angularjs","apache","bootstrap","bower","c","cplusplus","csharp","css3","vagrant","debian","docker","dot-net","html5","jasmine","javascript","jquery","mongodb","mysql","nginx","php-flat","react","typescript","ubuntu","wordpress"];mobilecheck()&&n.splice(14);let a;n.forEach((e,r)=>{r%parseInt(n.length/3)!=0&&0!==r||(a=document.createElement("br"),t.appendChild(a));let s=document.createElement("img"),o=document.createElement("div");o.className="icon alive",s.alt=e,s.title=e,s.src="assets/images/"+e+".svg",o.dataset.name=e,o.appendChild(s),t.appendChild(o)});new Game}document.querySelector("span.strikethrough").style.setProperty("outline-offset","-12px");let t=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},n=document.getElementById("contact-form"),a=document.querySelector(".spinner");document.getElementById("sendMessage").addEventListener("click",()=>{setTimeout(()=>{document.querySelector("#contact > .container").scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},200)}),n.addEventListener("submit",e=>{e.preventDefault();var n=new XMLHttpRequest;let r={c_name:e.target.c_name.value,c_message:e.target.c_message.value,c_email:e.target.c_email.value};var s=t(r);return n.open("POST","/assets/php/handleFormSubmit.php",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){let e=document.querySelector(".ajax-response");e.innerHTML=JSON.parse(n.responseText).message,e.classList.add("active")}a.classList.remove("active")},n.send(s),a.classList.add("active"),!1}),window.addEventListener("scroll",e),[...document.querySelectorAll("img")].forEach(e=>{e.dataset.src&&(e.src=e.dataset.src)})},!1),window.addEventListener("resize",()=>{requestAnimationFrame(resizeHomeSection)});let links=[...document.querySelectorAll("a[href^='#'")];links.forEach(e=>{e.addEventListener("click",t=>(t.preventDefault(),document.querySelector(e.getAttribute("href")).scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),!1))});


function preventDefault(t){(t=t||window.event).preventDefault&&t.preventDefault(),t.returnValue=!1}function preventDefaultForScrollKeys(t){if(keys[t.keyCode])return preventDefault(t),!1}function disableScroll(){window.addEventListener&&window.addEventListener("DOMMouseScroll",preventDefault,!1),window.onwheel=preventDefault,window.onmousewheel=document.onmousewheel=preventDefault,window.ontouchmove=preventDefault,document.onkeydown=preventDefaultForScrollKeys}function enableScroll(){window.removeEventListener&&window.removeEventListener("DOMMouseScroll",preventDefault,!1),window.onmousewheel=document.onmousewheel=null,window.onwheel=null,window.ontouchmove=null,document.onkeydown=null}const State={PAUSED:"paused",VIRGIN:"virgin",RUNNING:"running",LOST:"lost",WIN:"win"};window.mobilecheck=function(){var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t};var keys={37:1,38:1,39:1,40:1};const DEFAULT_SPEED=mobilecheck()?4:8;console.log(`Speed set to ${DEFAULT_SPEED}`);class Game{constructor(){this.ball=document.getElementById("ball"),this.pad=document.getElementById("pad"),this.gameWindow=document.getElementById("game-wrapper"),this.bricks=this.getBricks(),this.isDragging=!1,this.direction={x:1,y:1},this.state=State.VIRGIN,this.settings={ballSpeed:DEFAULT_SPEED},this.isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,mobilecheck()?(this.pad.addEventListener("touchstart",this.handleStart.bind(this),!1),document.addEventListener("touchend",this.handleEnd.bind(this),!1),document.addEventListener("touchcancel",this.handleEnd.bind(this),!1)):(document.addEventListener("mouseup",this.handleEnd.bind(this),!1),this.pad.addEventListener("mousedown",this.handleStart.bind(this),!1))}getBricks(){return Array.prototype.slice.call(this.gameWindow.querySelectorAll(".icons > .icon"))}attachEventListeners(){document.addEventListener("touchmove",this.handleMove.bind(this),!1),document.addEventListener("mousemove",this.handleMove.bind(this),!1)}deattachEventListeners(){document.removeEventListener("touchmove",this.handleMove,!1),document.removeEventListener("mousemove",this.handleMove,!1)}handleMove(t){if(this.isDragging){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1;let{x:e,y:i}=this.getWindowDimensions(),s="";s=(t.clientX||t.touches[0].clientX)-(e-this.gameWindow.offsetWidth)/2+"px",this.pad.style.setProperty("left",s)}return!1}handleEnd(t){this.isDragging&&(0!=t.button&&void 0!==t.button||(this.isDragging=!1,this.removeMessageTimeout&&clearTimeout(this.removeMessageTimeout),this.deattachEventListeners(),enableScroll(),this.gameWindow.classList.add("paused"),this.slowBallDown(()=>{this.isDragging?this.startMovingSmooth(()=>{this.play()}):this.pauseGame()})))}handleStart(t){if(t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1,0==t.button||void 0===t.button)switch(this.isDragging=!0,this.attachEventListeners(),this.removeMessageTimeout=setTimeout(()=>{let t=document.querySelector(".explanation-wrapper"),e=t.querySelector("span > img");if(!e)return;let i=t.querySelector("span > span");t.style.setProperty("height",t.offsetHeight+"px"),e.parentElement.removeChild(e),i.innerHTML="Release to pause"},3e3),disableScroll(),this.state){case State.VIRGIN:this.gameWindow.className="",this.launchBall();break;case State.LOST:this.resetGame();break;case State.PAUSED:this.startMovingSmooth(()=>{this.play()})}return!1}getWindowDimensions(){let t=window,e=document,i=e.documentElement,s=e.getElementsByTagName("body")[0];return{x:t.innerWidth||i.clientWidth||s.clientWidth,y:t.innerHeight||i.clientHeight||s.clientHeight}}launchBall(){this.play(),this.moveBall()}getElementOffsetTop(t){let e=getComputedStyle(this.gameWindow),i=parseInt(e["border-top-width"]);return this.isFirefox?t.offsetTop-i:t.offsetTop}getElementOffsetLeft(t){let e=getComputedStyle(this.gameWindow),i=parseInt(e["border-left-width"]);return this.isFirefox?t.offsetLeft-i:t.offsetLeft}resetGame(){this.state==State.LOST&&(this.gameWindow.classList.remove("lost"),this.ball.style.display="block",this.ball.style.left=this.getElementOffsetLeft(this.pad)+(this.pad.offsetWidth-this.ball.offsetWidth/2)+"px",this.ball.style.top=this.getElementOffsetTop(this.pad.parentElement)-this.ball.offsetHeight+"px",this.state=State.RUNNING,this.gameWindow.className="",this.settings.ballSpeed=DEFAULT_SPEED,this.direction={x:1,y:1},this.launchBall())}endGame(){this.state=State.LOST,this.gameWindow.classList.add("lost"),this.ball.style.display="none"}slowBallDown(t){let e=setInterval(()=>{if(0==this.settings.ballSpeed--||this.isDragging)return clearInterval(e),void t()},100)}startMovingSmooth(t){if(t(),this.settings.ballSpeed==DEFAULT_SPEED)return;let e=setInterval(()=>{if(this.settings.ballSpeed++>=5)return clearInterval(e),this.settings.ballSpeed=DEFAULT_SPEED,void this.gameWindow.classList.remove("paused")},100)}pauseGame(){this.state==State.RUNNING&&(this.state=State.PAUSED)}play(){this.state=State.RUNNING}collision(t,e,i=!0){let s,o;i?(s={radius:t.offsetHeight/2,x:this.getElementOffsetLeft(t)+t.offsetHeight/2,y:this.gameWindow.offsetHeight-this.getElementOffsetTop(t)-t.offsetWidth/2},o={radius:e.offsetWidth/2,x:this.getElementOffsetLeft(e)+e.offsetWidth/2,y:this.gameWindow.offsetHeight-this.getElementOffsetTop(e)-e.offsetWidth/2}):(s=t,o=e);var n=s.x-o.x,a=s.y-o.y;let l=Math.sqrt(n*n+a*a)<=s.radius+o.radius;return s.x-=o.x,s.y-=o.y,!!l&&{x:s.x/Math.abs(s.x),y:s.y/Math.abs(s.y)}}blinkBorder(t){if("pad"==t)return;let e=t.toLowerCase();e=e.charAt(0).toUpperCase()+e.slice(1),this.gameWindow.style["border"+e+"Color"]="grey",setTimeout(()=>{this.gameWindow.style["border"+e+"Color"]="transparent"},1e3)}bounce(){let t=this.gameWindow.offsetWidth,e=this.gameWindow.offsetHeight;if(this.pad.parentElement.offsetTop+10<this.ball.offsetTop+this.ball.offsetHeight)throw"Lost";return this.getElementOffsetLeft(this.ball)<=0&&-1===this.direction.x?(this.ball.style.setProperty("left",0),this.direction.x=1,"left"):this.getElementOffsetTop(this.ball)<=0&&1===this.direction.y?(this.ball.style.setProperty("top",0),this.direction.y=-1,"top"):this.getElementOffsetLeft(this.ball)>=t-parseInt(this.ball.offsetWidth)&&1===this.direction.x?(this.ball.style.setProperty("top",e-parseInt(this.ball.offsetHeight)),this.direction.x=-1,"right"):this.getElementOffsetTop(this.ball)+21>=e-parseInt(this.ball.offsetHeight)&&-1===this.direction.y&&this.getElementOffsetLeft(this.ball)>this.getElementOffsetLeft(this.pad)-this.ball.offsetWidth-5&&this.getElementOffsetLeft(this.ball)<this.getElementOffsetLeft(this.pad)+this.pad.offsetWidth&&(this.direction.y=1,console.log("pad!!!"),"pad")}killBrick(t){t.classList.remove("alive");let e;for(let t=0;t<this.bricks.length;t++)if(!this.bricks[t].classList.contains("alive")){e=t;break}this.bricks.splice(e,1),ga("send",{hitType:"event",eventCategory:"Game",eventAction:"broken",eventLabel:"Brick Hits",eventValue:t.dataset.name})}victory(){this.state=State.WIN;let t=this.ball.querySelector("i");t.parentElement.removeChild(t),this.ball.style.setProperty("background-image","url('/assets/images/victory.jpg')"),this.ball.style.setProperty("background-size","contain"),this.ball.classList.add("victory"),document.querySelector(".explanation-wrapper").querySelector("span > span").innerHTML="V is for Viiictory!"}moveBall(){try{if(this.state==State.WIN)return;if(this.state==State.PAUSED)return void requestAnimationFrame(()=>{this.moveBall()});for(let t=0;t<this.settings.ballSpeed;t++){let t=this.bounce();t&&this.blinkBorder(t);let e=this.getElementOffsetLeft(this.ball)+this.direction.x+"px",i=this.getElementOffsetTop(this.ball)+-1*this.direction.y+"px";this.ball.style.setProperty("left",e),this.ball.style.setProperty("top",i);let s=this.getElementOffsetTop(this.ball),o=document.querySelector("div.icons .icon:last-child");s<this.getElementOffsetTop(o)+o.offsetHeight&&this.bricks.forEach(t=>{let e=this.collision(this.ball,t);(e.x||e.y)&&(this.settings.ballSpeed===DEFAULT_SPEED&&(this.killBrick(t),0===this.bricks.length&&this.victory()),e.x&&(this.direction.x=e.x),e.y&&(this.direction.y=e.y))})}requestAnimationFrame(()=>{this.moveBall()})}catch(t){if("Lost"!==t)throw this.endGame(),t;this.endGame()}}}


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImN1c3RvbS5qcyIsImdhbWUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FDRkE7QUFDQTtBQUNBIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHtcblxuICBsZXQgc3RyaWtldGhyb3VnaCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJzcGFuLnN0cmlrZXRocm91Z2hcIik7XG4gIHN0cmlrZXRocm91Z2guc3R5bGUuc2V0UHJvcGVydHkoXCJvdXRsaW5lLW9mZnNldFwiLCBcIi0xMnB4XCIpO1xuXG4gIGZ1bmN0aW9uIHN0YXJ0R2FtZSgpIHtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgc3RhcnRHYW1lKTtcbiAgICBcbiAgICBsZXQgaWNvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2dhbWUtd3JhcHBlciAuaWNvbnNcIik7XG4gICAgbGV0IHRlY2hzID0gW1wiYW5ndWxhcmpzXCIsIFwiYXBhY2hlXCIsIFwiYm9vdHN0cmFwXCIsIFwiYm93ZXJcIiwgXCJjXCIsIFwiY3BsdXNwbHVzXCIsIFwiY3NoYXJwXCIsIFwiY3NzM1wiLCBcInZhZ3JhbnRcIiwgXCJkZWJpYW5cIiwgXCJkb2NrZXJcIiwgXCJkb3QtbmV0XCIsIFwiaHRtbDVcIiwgXCJqYXNtaW5lXCIsIFwiamF2YXNjcmlwdFwiLCBcImpxdWVyeVwiLCBcIm1vbmdvZGJcIiwgXCJteXNxbFwiLCBcIm5naW54XCIsIFwicGhwLWZsYXRcIiwgXCJyZWFjdFwiLCBcInR5cGVzY3JpcHRcIiwgXCJ1YnVudHVcIiwgXCJ3b3JkcHJlc3NcIl07XG4gICAgaWYgKG1vYmlsZWNoZWNrKCkpIHtcbiAgICAgIHRlY2hzLnNwbGljZSgxNCk7XG4gICAgfVxuICBcbiAgICBsZXQgZGl2Um93O1xuICBcbiAgICB0ZWNocy5mb3JFYWNoKCh0ZWNoLCBpbmRleCkgPT4ge1xuICBcbiAgICAgIGlmIChpbmRleCAlIHBhcnNlSW50KHRlY2hzLmxlbmd0aC8zKSA9PT0gMCB8fCBpbmRleCA9PT0gMCkge1xuICAgICAgICBkaXZSb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnJcIik7XG4gICAgICAgIGljb25zLmFwcGVuZENoaWxkKGRpdlJvdyk7XG4gICAgICB9XG4gIFxuICAgICAgbGV0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcbiAgICAgIGxldCBpY29uV3JhcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBpY29uV3JhcC5jbGFzc05hbWUgPSBcImljb24gYWxpdmVcIjtcbiAgICAgIGltYWdlLmFsdCA9IHRlY2g7XG4gICAgICBpbWFnZS50aXRsZSA9IHRlY2g7XG4gICAgICBpbWFnZS5zcmMgPSBcImFzc2V0cy9pbWFnZXMvXCIgKyB0ZWNoICsgXCIuc3ZnXCI7XG4gICAgICBpY29uV3JhcC5kYXRhc2V0Lm5hbWUgPSB0ZWNoO1xuICBcbiAgICAgIGljb25XcmFwLmFwcGVuZENoaWxkKGltYWdlKTtcbiAgICAgIGljb25zLmFwcGVuZENoaWxkKGljb25XcmFwKTtcbiAgICB9KTtcbiAgXG4gICAgbGV0IGF3ZXNvbWVHYW1lID0gbmV3IEdhbWUoKTtcbiAgfVxuXG4gIGxldCBvYmplY3RUb1F1ZXJ5U3RyaW5nID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgdmFyIHN0ciA9IFtdO1xuICAgIGZvcih2YXIgcCBpbiBvYmopXG4gICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KHApKSB7XG4gICAgICAgIHN0ci5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChwKSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KG9ialtwXSkpO1xuICAgICAgfVxuICAgIHJldHVybiBzdHIuam9pbihcIiZcIik7XG4gIH1cblxuICBsZXQgY29udGFjdEZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbnRhY3QtZm9ybVwiKTtcbiAgbGV0IGxvYWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc3Bpbm5lclwiKTtcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbmRNZXNzYWdlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY29udGFjdCA+IC5jb250YWluZXInKS5zY3JvbGxJbnRvVmlldyh7YmVoYXZpb3I6IFwic21vb3RoXCIsIGJsb2NrOiBcInN0YXJ0XCIsIGlubGluZTogXCJuZWFyZXN0XCJ9KTtcbiAgICB9LCAyMDApO1xuICB9KTtcbiAgY29udGFjdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZlbnQpID0+IHtcbiAgICBcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHZhciBodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgdmFyIHVybCA9IFwiL2Fzc2V0cy9waHAvaGFuZGxlRm9ybVN1Ym1pdC5waHBcIjtcbiAgICBsZXQgcG9zdCA9IHtcbiAgICAgIGNfbmFtZSA6IGV2ZW50LnRhcmdldC5jX25hbWUudmFsdWUsXG4gICAgICBjX21lc3NhZ2U6IGV2ZW50LnRhcmdldC5jX21lc3NhZ2UudmFsdWUsXG4gICAgICBjX2VtYWlsOiBldmVudC50YXJnZXQuY19lbWFpbC52YWx1ZVxuICAgIH07XG4gICAgdmFyIHBhcmFtcyA9IG9iamVjdFRvUXVlcnlTdHJpbmcocG9zdCk7XG4gICAgaHR0cC5vcGVuKFwiUE9TVFwiLCB1cmwsIHRydWUpO1xuICAgIFxuICAgIC8vU2VuZCB0aGUgcHJvcGVyIGhlYWRlciBpbmZvcm1hdGlvbiBhbG9uZyB3aXRoIHRoZSByZXF1ZXN0XG4gICAgaHR0cC5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC10eXBlXCIsIFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIpO1xuICAgIFxuICAgIGh0dHAub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7Ly9DYWxsIGEgZnVuY3Rpb24gd2hlbiB0aGUgc3RhdGUgY2hhbmdlcy5cbiAgICAgICAgaWYoaHR0cC5yZWFkeVN0YXRlID09IDQgJiYgaHR0cC5zdGF0dXMgPT0gMjAwKSB7XG4gICAgICAgICAgbGV0IHJlc3BvbnNlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5hamF4LXJlc3BvbnNlXCIpO1xuICAgICAgICAgIHJlc3BvbnNlLmlubmVySFRNTCA9IEpTT04ucGFyc2UoaHR0cC5yZXNwb25zZVRleHQpLm1lc3NhZ2U7XG4gICAgICAgICAgcmVzcG9uc2UuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG4gICAgICAgIH1cbiAgICAgICAgbG9hZGVyLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgIH1cbiAgICBodHRwLnNlbmQocGFyYW1zKTtcbiAgICBcbiAgICBsb2FkZXIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG4gICAgXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9KTtcblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgc3RhcnRHYW1lKTtcblxuICBsZXQgaW1hZ2VzID0gWy4uLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZycpXTtcbiAgaW1hZ2VzLmZvckVhY2goKGltYWdlKSA9PiB7XG4gICAgaWYgKGltYWdlLmRhdGFzZXQuc3JjKSB7XG4gICAgICBpbWFnZS5zcmMgPSBpbWFnZS5kYXRhc2V0LnNyYztcbiAgICB9XG4gIH0pO1xuXHRcbn0sIGZhbHNlKTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgKCkgPT4ge1xuICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVzaXplSG9tZVNlY3Rpb24pO1xufSk7XG5cbmxldCBsaW5rcyA9IFsuLi5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiYVtocmVmXj0nIydcIildO1xubGlua3MuZm9yRWFjaChsaW5rID0+IHtcbiAgbGluay5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZXZlbnQgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihsaW5rLmdldEF0dHJpYnV0ZSgnaHJlZicpKS5zY3JvbGxJbnRvVmlldyh7YmVoYXZpb3I6IFwic21vb3RoXCIsIGJsb2NrOiBcInN0YXJ0XCIsIGlubGluZTogXCJuZWFyZXN0XCJ9KTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0pO1xufSk7XG4iLCJjb25zdCBTdGF0ZSA9IHtcbiAgUEFVU0VEOiAncGF1c2VkJyxcbiAgVklSR0lOOiAndmlyZ2luJyxcbiAgUlVOTklORzogJ3J1bm5pbmcnLFxuICBMT1NUOiAnbG9zdCcsXG4gIFdJTjogJ3dpbidcbn07XG5cbndpbmRvdy5tb2JpbGVjaGVjayA9IGZ1bmN0aW9uKCkge1xuICB2YXIgY2hlY2sgPSBmYWxzZTtcbiAgKGZ1bmN0aW9uKGEpe2lmKC8oYW5kcm9pZHxiYlxcZCt8bWVlZ28pLittb2JpbGV8YXZhbnRnb3xiYWRhXFwvfGJsYWNrYmVycnl8YmxhemVyfGNvbXBhbHxlbGFpbmV8ZmVubmVjfGhpcHRvcHxpZW1vYmlsZXxpcChob25lfG9kKXxpcmlzfGtpbmRsZXxsZ2UgfG1hZW1vfG1pZHB8bW1wfG1vYmlsZS4rZmlyZWZveHxuZXRmcm9udHxvcGVyYSBtKG9ifGluKWl8cGFsbSggb3MpP3xwaG9uZXxwKGl4aXxyZSlcXC98cGx1Y2tlcnxwb2NrZXR8cHNwfHNlcmllcyg0fDYpMHxzeW1iaWFufHRyZW98dXBcXC4oYnJvd3NlcnxsaW5rKXx2b2RhZm9uZXx3YXB8d2luZG93cyBjZXx4ZGF8eGlpbm8vaS50ZXN0KGEpfHwvMTIwN3w2MzEwfDY1OTB8M2dzb3w0dGhwfDUwWzEtNl1pfDc3MHN8ODAyc3xhIHdhfGFiYWN8YWMoZXJ8b298c1xcLSl8YWkoa298cm4pfGFsKGF2fGNhfGNvKXxhbW9pfGFuKGV4fG55fHl3KXxhcHR1fGFyKGNofGdvKXxhcyh0ZXx1cyl8YXR0d3xhdShkaXxcXC1tfHIgfHMgKXxhdmFufGJlKGNrfGxsfG5xKXxiaShsYnxyZCl8YmwoYWN8YXopfGJyKGV8dil3fGJ1bWJ8YndcXC0obnx1KXxjNTVcXC98Y2FwaXxjY3dhfGNkbVxcLXxjZWxsfGNodG18Y2xkY3xjbWRcXC18Y28obXB8bmQpfGNyYXd8ZGEoaXR8bGx8bmcpfGRidGV8ZGNcXC1zfGRldml8ZGljYXxkbW9ifGRvKGN8cClvfGRzKDEyfFxcLWQpfGVsKDQ5fGFpKXxlbShsMnx1bCl8ZXIoaWN8azApfGVzbDh8ZXooWzQtN10wfG9zfHdhfHplKXxmZXRjfGZseShcXC18Xyl8ZzEgdXxnNTYwfGdlbmV8Z2ZcXC01fGdcXC1tb3xnbyhcXC53fG9kKXxncihhZHx1bil8aGFpZXxoY2l0fGhkXFwtKG18cHx0KXxoZWlcXC18aGkocHR8dGEpfGhwKCBpfGlwKXxoc1xcLWN8aHQoYyhcXC18IHxffGF8Z3xwfHN8dCl8dHApfGh1KGF3fHRjKXxpXFwtKDIwfGdvfG1hKXxpMjMwfGlhYyggfFxcLXxcXC8pfGlicm98aWRlYXxpZzAxfGlrb218aW0xa3xpbm5vfGlwYXF8aXJpc3xqYSh0fHYpYXxqYnJvfGplbXV8amlnc3xrZGRpfGtlaml8a2d0KCB8XFwvKXxrbG9ufGtwdCB8a3djXFwtfGt5byhjfGspfGxlKG5vfHhpKXxsZyggZ3xcXC8oa3xsfHUpfDUwfDU0fFxcLVthLXddKXxsaWJ3fGx5bnh8bTFcXC13fG0zZ2F8bTUwXFwvfG1hKHRlfHVpfHhvKXxtYygwMXwyMXxjYSl8bVxcLWNyfG1lKHJjfHJpKXxtaShvOHxvYXx0cyl8bW1lZnxtbygwMXwwMnxiaXxkZXxkb3x0KFxcLXwgfG98dil8enopfG10KDUwfHAxfHYgKXxtd2JwfG15d2F8bjEwWzAtMl18bjIwWzItM118bjMwKDB8Mil8bjUwKDB8Mnw1KXxuNygwKDB8MSl8MTApfG5lKChjfG0pXFwtfG9ufHRmfHdmfHdnfHd0KXxub2soNnxpKXxuenBofG8yaW18b3AodGl8d3YpfG9yYW58b3dnMXxwODAwfHBhbihhfGR8dCl8cGR4Z3xwZygxM3xcXC0oWzEtOF18YykpfHBoaWx8cGlyZXxwbChheXx1Yyl8cG5cXC0yfHBvKGNrfHJ0fHNlKXxwcm94fHBzaW98cHRcXC1nfHFhXFwtYXxxYygwN3wxMnwyMXwzMnw2MHxcXC1bMi03XXxpXFwtKXxxdGVrfHIzODB8cjYwMHxyYWtzfHJpbTl8cm8odmV8em8pfHM1NVxcL3xzYShnZXxtYXxtbXxtc3xueXx2YSl8c2MoMDF8aFxcLXxvb3xwXFwtKXxzZGtcXC98c2UoYyhcXC18MHwxKXw0N3xtY3xuZHxyaSl8c2doXFwtfHNoYXJ8c2llKFxcLXxtKXxza1xcLTB8c2woNDV8aWQpfHNtKGFsfGFyfGIzfGl0fHQ1KXxzbyhmdHxueSl8c3AoMDF8aFxcLXx2XFwtfHYgKXxzeSgwMXxtYil8dDIoMTh8NTApfHQ2KDAwfDEwfDE4KXx0YShndHxsayl8dGNsXFwtfHRkZ1xcLXx0ZWwoaXxtKXx0aW1cXC18dFxcLW1vfHRvKHBsfHNoKXx0cyg3MHxtXFwtfG0zfG01KXx0eFxcLTl8dXAoXFwuYnxnMXxzaSl8dXRzdHx2NDAwfHY3NTB8dmVyaXx2aShyZ3x0ZSl8dmsoNDB8NVswLTNdfFxcLXYpfHZtNDB8dm9kYXx2dWxjfHZ4KDUyfDUzfDYwfDYxfDcwfDgwfDgxfDgzfDg1fDk4KXx3M2MoXFwtfCApfHdlYmN8d2hpdHx3aShnIHxuY3xudyl8d21sYnx3b251fHg3MDB8eWFzXFwtfHlvdXJ8emV0b3x6dGVcXC0vaS50ZXN0KGEuc3Vic3RyKDAsNCkpKSBjaGVjayA9IHRydWU7fSkobmF2aWdhdG9yLnVzZXJBZ2VudHx8bmF2aWdhdG9yLnZlbmRvcnx8d2luZG93Lm9wZXJhKTtcbiAgcmV0dXJuIGNoZWNrO1xufTtcblxuLy8gbGVmdDogMzcsIHVwOiAzOCwgcmlnaHQ6IDM5LCBkb3duOiA0MCxcbi8vIHNwYWNlYmFyOiAzMiwgcGFnZXVwOiAzMywgcGFnZWRvd246IDM0LCBlbmQ6IDM1LCBob21lOiAzNlxudmFyIGtleXMgPSB7Mzc6IDEsIDM4OiAxLCAzOTogMSwgNDA6IDF9O1xuXG5mdW5jdGlvbiBwcmV2ZW50RGVmYXVsdChlKSB7XG4gIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcbiAgaWYgKGUucHJldmVudERlZmF1bHQpXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIGUucmV0dXJuVmFsdWUgPSBmYWxzZTsgIFxufVxuXG5mdW5jdGlvbiBwcmV2ZW50RGVmYXVsdEZvclNjcm9sbEtleXMoZSkge1xuICAgIGlmIChrZXlzW2Uua2V5Q29kZV0pIHtcbiAgICAgICAgcHJldmVudERlZmF1bHQoZSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGRpc2FibGVTY3JvbGwoKSB7XG4gIGlmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikgLy8gb2xkZXIgRkZcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdET01Nb3VzZVNjcm9sbCcsIHByZXZlbnREZWZhdWx0LCBmYWxzZSk7XG4gIHdpbmRvdy5vbndoZWVsID0gcHJldmVudERlZmF1bHQ7IC8vIG1vZGVybiBzdGFuZGFyZFxuICB3aW5kb3cub25tb3VzZXdoZWVsID0gZG9jdW1lbnQub25tb3VzZXdoZWVsID0gcHJldmVudERlZmF1bHQ7IC8vIG9sZGVyIGJyb3dzZXJzLCBJRVxuICB3aW5kb3cub250b3VjaG1vdmUgID0gcHJldmVudERlZmF1bHQ7IC8vIG1vYmlsZVxuICBkb2N1bWVudC5vbmtleWRvd24gID0gcHJldmVudERlZmF1bHRGb3JTY3JvbGxLZXlzO1xufVxuXG5mdW5jdGlvbiBlbmFibGVTY3JvbGwoKSB7XG4gICAgaWYgKHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKVxuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignRE9NTW91c2VTY3JvbGwnLCBwcmV2ZW50RGVmYXVsdCwgZmFsc2UpO1xuICAgIHdpbmRvdy5vbm1vdXNld2hlZWwgPSBkb2N1bWVudC5vbm1vdXNld2hlZWwgPSBudWxsOyBcbiAgICB3aW5kb3cub253aGVlbCA9IG51bGw7IFxuICAgIHdpbmRvdy5vbnRvdWNobW92ZSA9IG51bGw7ICBcbiAgICBkb2N1bWVudC5vbmtleWRvd24gPSBudWxsOyAgXG59XG5cbmNvbnN0IERFRkFVTFRfU1BFRUQgPSBtb2JpbGVjaGVjaygpID8gNCA6IDg7XG5cbmNvbnNvbGUubG9nKGBTcGVlZCBzZXQgdG8gJHtERUZBVUxUX1NQRUVEfWApO1xuXG5jbGFzcyBHYW1lIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5iYWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJiYWxsXCIpO1xuICAgIHRoaXMucGFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwYWRcIik7XG4gICAgdGhpcy5nYW1lV2luZG93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJnYW1lLXdyYXBwZXJcIik7XG4gICAgdGhpcy5icmlja3MgPSB0aGlzLmdldEJyaWNrcygpO1xuICAgIHRoaXMuaXNEcmFnZ2luZyA9IGZhbHNlO1xuICAgIHRoaXMuZGlyZWN0aW9uID0ge1xuICAgICAgeDogMSxcbiAgICAgIHk6IDFcbiAgICB9O1xuICAgIHRoaXMuc3RhdGUgPSBTdGF0ZS5WSVJHSU47XG4gICAgdGhpcy5zZXR0aW5ncyA9IHtcbiAgICAgIGJhbGxTcGVlZDogREVGQVVMVF9TUEVFRFxuICAgIH07XG4gICAgdGhpcy5pc0ZpcmVmb3ggPSBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZignZmlyZWZveCcpID4gLTE7XG5cbiAgICBpZiAobW9iaWxlY2hlY2soKSkge1xuICAgICAgdGhpcy5wYWQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgdGhpcy5oYW5kbGVTdGFydC5iaW5kKHRoaXMpLCBmYWxzZSk7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgdGhpcy5oYW5kbGVFbmQuYmluZCh0aGlzKSwgZmFsc2UpO1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoY2FuY2VsXCIsIHRoaXMuaGFuZGxlRW5kLmJpbmQodGhpcyksIGZhbHNlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy5oYW5kbGVFbmQuYmluZCh0aGlzKSwgZmFsc2UpO1xuICAgICAgdGhpcy5wYWQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLmhhbmRsZVN0YXJ0LmJpbmQodGhpcyksIGZhbHNlKTtcbiAgICB9XG4gICAgXG4gIH1cblxuICBnZXRCcmlja3MoKSB7XG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHRoaXMuZ2FtZVdpbmRvdy5xdWVyeVNlbGVjdG9yQWxsKFwiLmljb25zID4gLmljb25cIikpXG4gIH1cblxuICBhdHRhY2hFdmVudExpc3RlbmVycygpIHtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIHRoaXMuaGFuZGxlTW92ZS5iaW5kKHRoaXMpLCBmYWxzZSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCB0aGlzLmhhbmRsZU1vdmUuYmluZCh0aGlzKSwgZmFsc2UpO1xuICB9XG5cbiAgZGVhdHRhY2hFdmVudExpc3RlbmVycygpIHtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIHRoaXMuaGFuZGxlTW92ZSwgZmFsc2UpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgdGhpcy5oYW5kbGVNb3ZlLCBmYWxzZSk7XG4gIH1cblxuICBoYW5kbGVNb3ZlKGV2ZW50KSB7XG4gICAgaWYgKHRoaXMuaXNEcmFnZ2luZykge1xuICAgICAgICBpZihldmVudC5zdG9wUHJvcGFnYXRpb24pIHtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIGlmKGV2ZW50LnByZXZlbnREZWZhdWx0KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgICAgIGV2ZW50LmNhbmNlbEJ1YmJsZSA9IHRydWU7XG4gICAgICAgIGV2ZW50LnJldHVyblZhbHVlID0gZmFsc2U7XG4gICAgICBcbiAgICAgIGxldCB7eCwgeX0gPSB0aGlzLmdldFdpbmRvd0RpbWVuc2lvbnMoKSxcbiAgICAgICAgbGVmdCA9IFwiXCIsIGNsaWVudFggPSBldmVudC5jbGllbnRYIHx8IGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WDtcbiAgICAgIGxlZnQgPSAoY2xpZW50WCAtICgoeCAtIHRoaXMuZ2FtZVdpbmRvdy5vZmZzZXRXaWR0aCkvMikpICsgXCJweFwiXG4gICAgICB0aGlzLnBhZC5zdHlsZS5zZXRQcm9wZXJ0eShcImxlZnRcIiwgbGVmdCk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGhhbmRsZUVuZChldmVudCkge1xuICAgIGlmICghdGhpcy5pc0RyYWdnaW5nKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChldmVudC5idXR0b24gPT0gMCB8fCBldmVudC5idXR0b24gPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5pc0RyYWdnaW5nID0gZmFsc2U7XG4gICAgICBpZiAodGhpcy5yZW1vdmVNZXNzYWdlVGltZW91dCkge1xuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5yZW1vdmVNZXNzYWdlVGltZW91dCk7XG4gICAgICB9XG4gICAgICB0aGlzLmRlYXR0YWNoRXZlbnRMaXN0ZW5lcnMoKTtcbiAgICAgIGVuYWJsZVNjcm9sbCgpO1xuICAgICAgdGhpcy5nYW1lV2luZG93LmNsYXNzTGlzdC5hZGQoXCJwYXVzZWRcIik7XG4gICAgICB0aGlzLnNsb3dCYWxsRG93bigoKSA9PiB7XG4gICAgICAgIGlmICggISB0aGlzLmlzRHJhZ2dpbmcgKSB7XG4gICAgICAgICAgdGhpcy5wYXVzZUdhbWUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnN0YXJ0TW92aW5nU21vb3RoKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGxheSgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVTdGFydChldmVudCkge1xuXG4gICAgaWYoZXZlbnQuc3RvcFByb3BhZ2F0aW9uKSB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH1cbiAgICBpZihldmVudC5wcmV2ZW50RGVmYXVsdCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbiAgICBldmVudC5jYW5jZWxCdWJibGUgPSB0cnVlO1xuICAgIGV2ZW50LnJldHVyblZhbHVlID0gZmFsc2U7XG5cbiAgICBpZiAoZXZlbnQuYnV0dG9uID09IDAgfHwgZXZlbnQuYnV0dG9uID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuaXNEcmFnZ2luZyA9IHRydWU7XG4gICAgICB0aGlzLmF0dGFjaEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgICB0aGlzLnJlbW92ZU1lc3NhZ2VUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGxldCBleHBsYW5hdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZXhwbGFuYXRpb24td3JhcHBlclwiKTtcbiAgICAgICAgbGV0IGltYWdlID0gZXhwbGFuYXRpb24ucXVlcnlTZWxlY3RvcihcInNwYW4gPiBpbWdcIik7XG4gICAgICAgIGlmICghaW1hZ2UpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHRleHQgPSBleHBsYW5hdGlvbi5xdWVyeVNlbGVjdG9yKFwic3BhbiA+IHNwYW5cIik7XG4gICAgICAgIGV4cGxhbmF0aW9uLnN0eWxlLnNldFByb3BlcnR5KFwiaGVpZ2h0XCIsIGV4cGxhbmF0aW9uLm9mZnNldEhlaWdodCArIFwicHhcIik7XG4gICAgICAgIGltYWdlLnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQoaW1hZ2UpO1xuICAgICAgICB0ZXh0LmlubmVySFRNTCA9IFwiUmVsZWFzZSB0byBwYXVzZVwiO1xuICAgICAgfSwgMyAqIDEwMDApO1xuICAgICAgZGlzYWJsZVNjcm9sbCgpO1xuXG4gICAgICBzd2l0Y2godGhpcy5zdGF0ZSkge1xuICAgICAgICBjYXNlIFN0YXRlLlZJUkdJTjpcbiAgICAgICAgICB0aGlzLmdhbWVXaW5kb3cuY2xhc3NOYW1lID0gXCJcIjtcbiAgICAgICAgICB0aGlzLmxhdW5jaEJhbGwoKTtcbiAgICAgICAgICBcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBTdGF0ZS5MT1NUOlxuICAgICAgICAgIHRoaXMucmVzZXRHYW1lKCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgU3RhdGUuUEFVU0VEOlxuICAgICAgICAgIHRoaXMuc3RhcnRNb3ZpbmdTbW9vdGgoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wbGF5KCk7ICBcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBnZXRXaW5kb3dEaW1lbnNpb25zKCkgeyAgXG4gICAgbGV0IHcgPSB3aW5kb3csXG4gICAgICBkID0gZG9jdW1lbnQsXG4gICAgICBlID0gZC5kb2N1bWVudEVsZW1lbnQsXG4gICAgICBnID0gZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdLFxuICAgICAgeCA9IHcuaW5uZXJXaWR0aCB8fCBlLmNsaWVudFdpZHRoIHx8IGcuY2xpZW50V2lkdGgsXG4gICAgICB5ID0gdy5pbm5lckhlaWdodHx8IGUuY2xpZW50SGVpZ2h0fHwgZy5jbGllbnRIZWlnaHQ7XG4gICAgcmV0dXJuIHt4LCB5fTtcbiAgfVxuXG4gIGxhdW5jaEJhbGwoKSB7XG4gICAgdGhpcy5wbGF5KCk7XG4gICAgdGhpcy5tb3ZlQmFsbCgpO1xuICB9XG5cbiAgZ2V0RWxlbWVudE9mZnNldFRvcChlbGVtZW50KSB7ICAgIFxuICAgIGxldCBnYW1lV2luZG93Q3NzID0gZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmdhbWVXaW5kb3cpLFxuICAgICAgICBib3JkZXJXaWR0aCA9IHBhcnNlSW50KGdhbWVXaW5kb3dDc3NbXCJib3JkZXItdG9wLXdpZHRoXCJdKTtcbiAgICByZXR1cm4gdGhpcy5pc0ZpcmVmb3ggPyBlbGVtZW50Lm9mZnNldFRvcCAtIGJvcmRlcldpZHRoIDogZWxlbWVudC5vZmZzZXRUb3A7XG4gIH1cblxuICBnZXRFbGVtZW50T2Zmc2V0TGVmdChlbGVtZW50KSB7ICAgIFxuICAgIGxldCBnYW1lV2luZG93Q3NzID0gZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmdhbWVXaW5kb3cpLFxuICAgICAgICBib3JkZXJXaWR0aCA9IHBhcnNlSW50KGdhbWVXaW5kb3dDc3NbXCJib3JkZXItbGVmdC13aWR0aFwiXSk7XG4gICAgcmV0dXJuIHRoaXMuaXNGaXJlZm94ID8gZWxlbWVudC5vZmZzZXRMZWZ0IC0gYm9yZGVyV2lkdGggOiBlbGVtZW50Lm9mZnNldExlZnQ7XG4gIH1cblxuICByZXNldEdhbWUoKSB7XG4gICAgaWYgKHRoaXMuc3RhdGUgPT0gU3RhdGUuTE9TVCkge1xuICAgICAgdGhpcy5nYW1lV2luZG93LmNsYXNzTGlzdC5yZW1vdmUoXCJsb3N0XCIpO1xuICAgICAgLy8gY2hhbmdlIHRvIGRpc3BsYXkgPSBibG9jayBtdXN0IGJvbWUgYmVmb3JlIGJhbGwub2Zmc2V0SGVpZ2h0XG4gICAgICAvLyBiZWNhdXNlIG9mZnNldEhlaWdodCBmb3IgZWxlbWVudHMgbm90IGluIHRoZSBET00gd2lsbCBiZSAwXG4gICAgICB0aGlzLmJhbGwuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgIHRoaXMuYmFsbC5zdHlsZS5sZWZ0ID0gdGhpcy5nZXRFbGVtZW50T2Zmc2V0TGVmdCh0aGlzLnBhZCkgKyAodGhpcy5wYWQub2Zmc2V0V2lkdGggLSB0aGlzLmJhbGwub2Zmc2V0V2lkdGgvMikgKyBcInB4XCI7XG4gICAgICB0aGlzLmJhbGwuc3R5bGUudG9wID0gKHRoaXMuZ2V0RWxlbWVudE9mZnNldFRvcCh0aGlzLnBhZC5wYXJlbnRFbGVtZW50KSAtIHRoaXMuYmFsbC5vZmZzZXRIZWlnaHQpICsgXCJweFwiO1xuICAgICAgdGhpcy5zdGF0ZSA9IFN0YXRlLlJVTk5JTkc7XG4gICAgICB0aGlzLmdhbWVXaW5kb3cuY2xhc3NOYW1lID0gXCJcIjtcblxuICAgICAgdGhpcy5zZXR0aW5ncy5iYWxsU3BlZWQgPSBERUZBVUxUX1NQRUVEO1xuXG4gICAgICB0aGlzLmRpcmVjdGlvbiA9IHtcbiAgICAgICAgeDogMSxcbiAgICAgICAgeTogMVxuICAgICAgfTtcblxuICAgICAgdGhpcy5sYXVuY2hCYWxsKCk7XG4gICAgfVxuICB9XG5cbiAgZW5kR2FtZSgpIHtcbiAgICB0aGlzLnN0YXRlID0gU3RhdGUuTE9TVDtcbiAgICB0aGlzLmdhbWVXaW5kb3cuY2xhc3NMaXN0LmFkZChcImxvc3RcIik7XG4gICAgdGhpcy5iYWxsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgfVxuXG4gIHNsb3dCYWxsRG93bihjYikge1xuXG4gICAgbGV0IGludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuYmFsbFNwZWVkLS0gPT0gMCB8fCB0aGlzLmlzRHJhZ2dpbmcpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XG4gICAgICAgIGNiKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9LCAxMDApO1xuICB9XG5cbiAgc3RhcnRNb3ZpbmdTbW9vdGgoY2IpIHtcbiAgICBjYigpO1xuICAgIGlmICh0aGlzLnNldHRpbmdzLmJhbGxTcGVlZCA9PSBERUZBVUxUX1NQRUVEKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCBpbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgIGlmICh0aGlzLnNldHRpbmdzLmJhbGxTcGVlZCsrID49IDUpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XG4gICAgICAgIC8vIGhhY2sgZm9yIGJ1ZyByZXNpc3RhbmNlIEItfFxuICAgICAgICB0aGlzLnNldHRpbmdzLmJhbGxTcGVlZCA9IERFRkFVTFRfU1BFRUQ7XG4gICAgICAgIHRoaXMuZ2FtZVdpbmRvdy5jbGFzc0xpc3QucmVtb3ZlKFwicGF1c2VkXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfSwgMTAwKTtcbiAgfVxuXG4gIHBhdXNlR2FtZSgpIHtcbiAgICBpZiAodGhpcy5zdGF0ZSA9PSBTdGF0ZS5SVU5OSU5HKSB7XG4gICAgICB0aGlzLnN0YXRlID0gU3RhdGUuUEFVU0VEO1xuICAgICAgXG4gICAgfVxuICB9XG5cbiAgcGxheSgpIHtcbiAgICB0aGlzLnN0YXRlID0gU3RhdGUuUlVOTklORztcbiAgICBcbiAgfVxuXG4gIGNvbGxpc2lvbigkZGl2MSwgJGRpdjIsIGFyZU5vdEVsZW1lbnRzID0gdHJ1ZSkge1xuICAgIGxldCBjaXJjbGUxLCBjaXJjbGUyO1xuXG4gICAgaWYgKCBhcmVOb3RFbGVtZW50cyApIHtcbiAgICAgIGNpcmNsZTEgPSB7XG4gICAgICAgIHJhZGl1czogJGRpdjEub2Zmc2V0SGVpZ2h0LzIsIFxuICAgICAgICB4OiB0aGlzLmdldEVsZW1lbnRPZmZzZXRMZWZ0KCRkaXYxKSArICRkaXYxLm9mZnNldEhlaWdodC8yLCBcbiAgICAgICAgeTogdGhpcy5nYW1lV2luZG93Lm9mZnNldEhlaWdodCAtIHRoaXMuZ2V0RWxlbWVudE9mZnNldFRvcCgkZGl2MSkgLSAkZGl2MS5vZmZzZXRXaWR0aC8yXG4gICAgICB9O1xuICAgICAgY2lyY2xlMiA9IHtcbiAgICAgICAgcmFkaXVzOiAkZGl2Mi5vZmZzZXRXaWR0aC8yLFxuICAgICAgICB4OiB0aGlzLmdldEVsZW1lbnRPZmZzZXRMZWZ0KCRkaXYyKSArICRkaXYyLm9mZnNldFdpZHRoLzIsIFxuICAgICAgICB5OiB0aGlzLmdhbWVXaW5kb3cub2Zmc2V0SGVpZ2h0IC0gdGhpcy5nZXRFbGVtZW50T2Zmc2V0VG9wKCRkaXYyKSAtICRkaXYyLm9mZnNldFdpZHRoLzJcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGNpcmNsZTEgPSAkZGl2MTtcbiAgICAgIGNpcmNsZTIgPSAkZGl2MlxuICAgIH1cblxuICAgIHZhciBkeCA9IGNpcmNsZTEueCAtIGNpcmNsZTIueDtcbiAgICB2YXIgZHkgPSBjaXJjbGUxLnkgLSBjaXJjbGUyLnk7XG4gICAgdmFyIGRpc3RhbmNlID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTtcblxuICAgIGxldCByYWRpdXNTdW0gPSBjaXJjbGUxLnJhZGl1cyArIGNpcmNsZTIucmFkaXVzO1xuXG4gICAgbGV0IGlzQ29sbGlzaW9uID0gZGlzdGFuY2UgPD0gcmFkaXVzU3VtO1xuICAgIGNpcmNsZTEueCAtPSBjaXJjbGUyLng7XG4gICAgY2lyY2xlMS55IC09IGNpcmNsZTIueTtcblxuICAgIGlmIChpc0NvbGxpc2lvbikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgeDogY2lyY2xlMS54IC8gTWF0aC5hYnMoY2lyY2xlMS54KSxcbiAgICAgICAgeTogY2lyY2xlMS55IC8gTWF0aC5hYnMoY2lyY2xlMS55KVxuICAgICAgfTtcblxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgYmxpbmtCb3JkZXIoc2lkZSkge1xuICAgIGlmIChzaWRlID09IFwicGFkXCIpIHJldHVybjtcbiAgICBsZXQgc2FuaXR6ZWRTaWRlID0gc2lkZS50b0xvd2VyQ2FzZSgpO1xuICAgIHNhbml0emVkU2lkZSA9IHNhbml0emVkU2lkZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHNhbml0emVkU2lkZS5zbGljZSgxKTtcbiAgICB0aGlzLmdhbWVXaW5kb3cuc3R5bGVbJ2JvcmRlcicgKyBzYW5pdHplZFNpZGUgKyAnQ29sb3InXSA9IFwiZ3JleVwiO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5nYW1lV2luZG93LnN0eWxlWydib3JkZXInICsgc2FuaXR6ZWRTaWRlICsgJ0NvbG9yJ10gPSBcInRyYW5zcGFyZW50XCI7XG4gICAgfSwgMTAwMCk7XG4gIH1cblxuICBib3VuY2UoKSB7XG4gICAgbGV0IHggPSB0aGlzLmdhbWVXaW5kb3cub2Zmc2V0V2lkdGgsIFxuICAgICAgICB5ID0gdGhpcy5nYW1lV2luZG93Lm9mZnNldEhlaWdodDtcblxuICAgIGlmICh0aGlzLnBhZC5wYXJlbnRFbGVtZW50Lm9mZnNldFRvcCArIDEwIDwgdGhpcy5iYWxsLm9mZnNldFRvcCArIHRoaXMuYmFsbC5vZmZzZXRIZWlnaHQpIHtcbiAgICAgIHRocm93ICdMb3N0JztcbiAgICB9XG5cbiAgICBpZiAodGhpcy5nZXRFbGVtZW50T2Zmc2V0TGVmdCh0aGlzLmJhbGwpIDw9IDAgJiYgdGhpcy5kaXJlY3Rpb24ueCA9PT0gLTEpIHtcbiAgICAgICAgdGhpcy5iYWxsLnN0eWxlLnNldFByb3BlcnR5KFwibGVmdFwiLCAwKTtcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24ueCA9IDE7XG4gICAgICAgIHJldHVybiAnbGVmdCc7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZ2V0RWxlbWVudE9mZnNldFRvcCh0aGlzLmJhbGwpIDw9IDAgJiYgdGhpcy5kaXJlY3Rpb24ueSA9PT0gMSkge1xuICAgICAgICB0aGlzLmJhbGwuc3R5bGUuc2V0UHJvcGVydHkoXCJ0b3BcIiwgMCk7XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uLnkgPSAtMTtcbiAgICAgICAgcmV0dXJuICd0b3AnO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmdldEVsZW1lbnRPZmZzZXRMZWZ0KHRoaXMuYmFsbCkgPj0geCAtIHBhcnNlSW50KHRoaXMuYmFsbC5vZmZzZXRXaWR0aCkgJiYgdGhpcy5kaXJlY3Rpb24ueCA9PT0gMSkge1xuICAgICAgICB0aGlzLmJhbGwuc3R5bGUuc2V0UHJvcGVydHkoXCJ0b3BcIiwgeSAtIHBhcnNlSW50KHRoaXMuYmFsbC5vZmZzZXRIZWlnaHQpKTtcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24ueCA9IC0xO1xuICAgICAgICByZXR1cm4gJ3JpZ2h0JztcbiAgICB9XG4gICAgIFxuXG4gICAgaWYgKHRoaXMuZ2V0RWxlbWVudE9mZnNldFRvcCh0aGlzLmJhbGwpICsgMjEgPj0geSAtIHBhcnNlSW50KHRoaXMuYmFsbC5vZmZzZXRIZWlnaHQpICYmIHRoaXMuZGlyZWN0aW9uLnkgPT09IC0xKSB7XG4gICAgICAgIGlmICh0aGlzLmdldEVsZW1lbnRPZmZzZXRMZWZ0KHRoaXMuYmFsbCkgPiB0aGlzLmdldEVsZW1lbnRPZmZzZXRMZWZ0KHRoaXMucGFkKSAtIHRoaXMuYmFsbC5vZmZzZXRXaWR0aCAtIDUgJiYgdGhpcy5nZXRFbGVtZW50T2Zmc2V0TGVmdCh0aGlzLmJhbGwpIDwgdGhpcy5nZXRFbGVtZW50T2Zmc2V0TGVmdCh0aGlzLnBhZCkgKyB0aGlzLnBhZC5vZmZzZXRXaWR0aCkge1xuICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24ueSA9IDE7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygncGFkISEhJyk7XG4gICAgICAgICAgICByZXR1cm4gJ3BhZCc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBcblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGtpbGxCcmljaygkYnJpY2spIHtcbiAgICAkYnJpY2suY2xhc3NMaXN0LnJlbW92ZShcImFsaXZlXCIpO1xuICAgIGxldCB0b1JlbW92ZTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYnJpY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgdG1wID0gdGhpcy5icmlja3NbaV07XG4gICAgICBpZiAoIXRtcC5jbGFzc0xpc3QuY29udGFpbnMoJ2FsaXZlJykpIHtcbiAgICAgICAgdG9SZW1vdmUgPSBpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmJyaWNrcy5zcGxpY2UodG9SZW1vdmUsIDEpO1xuXG4gICAgZ2EoJ3NlbmQnLCB7XG4gICAgICBoaXRUeXBlOiAnZXZlbnQnLFxuICAgICAgZXZlbnRDYXRlZ29yeTogJ0dhbWUnLFxuICAgICAgZXZlbnRBY3Rpb246ICdicm9rZW4nLFxuICAgICAgZXZlbnRMYWJlbDogJ0JyaWNrIEhpdHMnLFxuICAgICAgZXZlbnRWYWx1ZTogJGJyaWNrLmRhdGFzZXQubmFtZVxuICAgIH0pO1xuICB9XG5cbiAgdmljdG9yeSgpIHtcbiAgICB0aGlzLnN0YXRlID0gU3RhdGUuV0lOO1xuICAgIGxldCBwYXVzZUljb24gPSB0aGlzLmJhbGwucXVlcnlTZWxlY3RvcihcImlcIik7XG4gICAgcGF1c2VJY29uLnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQocGF1c2VJY29uKTtcblxuICAgIHRoaXMuYmFsbC5zdHlsZS5zZXRQcm9wZXJ0eSgnYmFja2dyb3VuZC1pbWFnZScsIFwidXJsKCcvYXNzZXRzL2ltYWdlcy92aWN0b3J5LmpwZycpXCIpO1xuICAgIHRoaXMuYmFsbC5zdHlsZS5zZXRQcm9wZXJ0eSgnYmFja2dyb3VuZC1zaXplJywgJ2NvbnRhaW4nKTtcbiAgICB0aGlzLmJhbGwuY2xhc3NMaXN0LmFkZChcInZpY3RvcnlcIik7XG5cbiAgICBsZXQgZXhwbGFuYXRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmV4cGxhbmF0aW9uLXdyYXBwZXJcIik7XG4gICAgbGV0IHRleHQgPSBleHBsYW5hdGlvbi5xdWVyeVNlbGVjdG9yKFwic3BhbiA+IHNwYW5cIik7XG4gICAgdGV4dC5pbm5lckhUTUwgPSBcIlYgaXMgZm9yIFZpaWljdG9yeSFcIjtcbiAgfVxuXG4gIG1vdmVCYWxsKCkge1xuICAgIHRyeSB7XG5cbiAgICAgIGlmICh0aGlzLnN0YXRlID09IFN0YXRlLldJTikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLnN0YXRlID09IFN0YXRlLlBBVVNFRCkge1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4geyB0aGlzLm1vdmVCYWxsKCk7IH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zZXR0aW5ncy5iYWxsU3BlZWQ7IGkrKykge1xuICAgICAgICBsZXQgYm91bmNlU2lkZSA9IHRoaXMuYm91bmNlKCk7XG5cbiAgICAgICAgaWYgKGJvdW5jZVNpZGUpIHtcbiAgICAgICAgICAgIHRoaXMuYmxpbmtCb3JkZXIoYm91bmNlU2lkZSk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgbGVmdCA9ICh0aGlzLmdldEVsZW1lbnRPZmZzZXRMZWZ0KHRoaXMuYmFsbCkgKyB0aGlzLmRpcmVjdGlvbi54KSArIFwicHhcIixcbiAgICAgICAgICAgIGEgPSB0aGlzLmdldEVsZW1lbnRPZmZzZXRUb3AodGhpcy5iYWxsKSxcbiAgICAgICAgICAgIGIgPSB0aGlzLmRpcmVjdGlvbi55ICogLTEsXG4gICAgICAgICAgICB0b3AgPSBhICsgYiArIFwicHhcIjtcblxuICAgICAgICB0aGlzLmJhbGwuc3R5bGUuc2V0UHJvcGVydHkoXCJsZWZ0XCIsIGxlZnQpO1xuICAgICAgICB0aGlzLmJhbGwuc3R5bGUuc2V0UHJvcGVydHkoXCJ0b3BcIiwgdG9wKTtcblxuICAgICAgICBsZXQgYmFsbFRvcCA9IHRoaXMuZ2V0RWxlbWVudE9mZnNldFRvcCh0aGlzLmJhbGwpLFxuICAgICAgICAgIGxhc3RJY29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImRpdi5pY29ucyAuaWNvbjpsYXN0LWNoaWxkXCIpLFxuICAgICAgICAgIHRvcFRocmVzaG9sZCA9IHRoaXMuZ2V0RWxlbWVudE9mZnNldFRvcChsYXN0SWNvbikgKyBsYXN0SWNvbi5vZmZzZXRIZWlnaHQ7XG4gICAgICAgIFxuICAgICAgICBpZiAoYmFsbFRvcCA8IHRvcFRocmVzaG9sZCkge1xuXG4gICAgICAgICAgdGhpcy5icmlja3MuZm9yRWFjaCgoJGJyaWNrKSA9PiB7XG4gICAgICAgICAgICBsZXQgaXNDb2xsaXNpb24gPSB0aGlzLmNvbGxpc2lvbih0aGlzLmJhbGwsICRicmljayk7XG5cblxuICAgICAgICAgICAgaWYgKGlzQ29sbGlzaW9uLnggfHwgaXNDb2xsaXNpb24ueSkge1xuICAgICAgICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5iYWxsU3BlZWQgPT09IERFRkFVTFRfU1BFRUQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmtpbGxCcmljaygkYnJpY2spO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmJyaWNrcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgIHRoaXMudmljdG9yeSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgaWYgKGlzQ29sbGlzaW9uLngpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbi54ID0gaXNDb2xsaXNpb24ueDtcbiAgICAgICAgICAgICAgfVxuICBcbiAgICAgICAgICAgICAgaWYgKGlzQ29sbGlzaW9uLnkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbi55ID0gaXNDb2xsaXNpb24ueTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBcbiAgICAgIH1cblxuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHsgdGhpcy5tb3ZlQmFsbCgpOyB9KTtcbiAgICB9ICBjYXRjaChlKSB7XG4gICAgICAgIGlmIChlID09PSBcIkxvc3RcIikge1xuICAgICAgICAgICAgdGhpcy5lbmRHYW1lKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmVuZEdhbWUoKTtcbiAgICAgICAgICAgIHRocm93IChlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl19
